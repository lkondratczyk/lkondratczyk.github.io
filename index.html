<!DOCTYPE html>
<html>
<head>
	<title>SF Neighborhoods</title>
    <script src="https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.js"></script>
	<link href="https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.css" rel="stylesheet" />
	<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>	

    <style>
    	#map { height: 700px; }
	</style>
</head>
<body>
	<div id = "map"></div>
	<script>
    	var map = L.map('map').setView([37.7200, -122.4167], 12);

		function addPopups(feature, layer){

			if(feature.properties.inBI === "true"){
				var image = document.createElement("IMG");
				image.setAttribute("src", feature.properties.popImg);
				image.setAttribute("width", "400");
				image.setAttribute("alt", feature.properties.name);
				
				image.onclick = function() {
					window.location.href = feature.properties.LINK;
				};
				
				var popupOptions = {
					'minWidth': '400px',
					'maxWidth': '400px',
				}
				
				layer.bindPopup(image, popupOptions);
			}
			else{
				if(feature.properties.LINK == null){
					layer.bindPopup(feature.properties.name, popupOptions);
				}
				else{
					var nameLink = feature.properties.name.link(feature.properties.LINK);
					layer.bindPopup(nameLink, popupOptions);
				}
			}
			
		}

		
		map.on('click', function(e) {
			setView([e.latlng.lat, e.latlng.lng], 12)
		});
		
		$.getJSON("https://gist.githubusercontent.com/lkondratczyk/51d43e0a7c968119a78e/raw/aa311590ccef10c91b83d93e10b94e72e82e5426/hoodBorders", 
				function(response) {
            console.log("response", response);
			
            L.geoJson(response, {
				style: function (feature) {
					if(feature.properties.inBI === "true"){
						var randColor;
						var r = Math.floor(Math.random() * 255);
						var g = Math.floor(Math.random() * 255);
						var b = Math.floor(Math.random() * 255);
						randColor= "rgb("+r+" ,"+g+","+ b+")"; 
						return {color: randColor};
					}
					else{
						return {color : "white"};
					}
				},
				onEachFeature: addPopups
			}).addTo(map);	 
        });

		L.mapbox.accessToken = 				
			'pk.eyJ1IjoibGtvbmRyYXRjenlrIiwiYSI6ImVlNjAzNTYwYTBjZDMwYzg5YjViY2U0MTQ3MTMzYzU3In0.' +
			'DDlX4LfLLK0iguFHb9OTqQ';
		L.tileLayer('https://{s}.tiles.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=' 
			+ L.mapbox.accessToken , {
    			attribution: '<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>',
   			 	maxZoom: 18,
		}).addTo(map);	
	</script>
</body>
</html>